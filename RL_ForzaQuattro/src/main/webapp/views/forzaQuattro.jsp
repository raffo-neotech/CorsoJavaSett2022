<!doctype html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
		
		<!-- Optional CSS -->
		<link rel="stylesheet" type="text/css" href="static/css/style.css" />
		<!-- Optional JavaScript -->
		<script type="text/javascript" src="static/js/script.js"></script>

		<title>Forza 4</title>
	</head>
	<body>
		<div class="container" style="text-align: center;">
			<div class="row">
				<div class="col-md-3">
					
				</div>
				<div class="col-md-6" style="min-width: 480px;">
					
				</div>
				<div class="col-md-3">
					
				</div>
			</div>
			<div class="clearfix"></div>
			
			<div class="row text-center">
				<div style="width: 478px; margin:auto auto auto auto ">
					<div class="rigo">
						<div id="C_1_1" class="casellaV"></div>
						<div id="C_1_2" class="casellaV"></div>
						<div id="C_1_3" class="casellaV"></div>
						<div id="C_1_4" class="casellaV"></div>
						<div id="C_1_5" class="casellaV"></div>
						<div id="C_1_6" class="casellaV"></div>
						<div id="C_1_7" class="casellaV"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<div id="C_2_1" class="casellaV"></div>
						<div id="C_2_2" class="casellaV"></div>
						<div id="C_2_3" class="casellaV"></div>
						<div id="C_2_4" class="casellaV"></div>
						<div id="C_2_5" class="casellaV"></div>
						<div id="C_2_6" class="casellaV"></div>
						<div id="C_2_7" class="casellaV"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<div id="C_3_1" class="casellaV"></div>
						<div id="C_3_2" class="casellaV"></div>
						<div id="C_3_3" class="casellaV"></div>
						<div id="C_3_4" class="casellaV"></div>
						<div id="C_3_5" class="casellaV"></div>
						<div id="C_3_6" class="casellaV"></div>
						<div id="C_3_7" class="casellaV"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<div id="C_4_1" class="casellaV"></div>
						<div id="C_4_2" class="casellaV"></div>
						<div id="C_4_3" class="casellaV"></div>
						<div id="C_4_4" class="casellaV"></div>
						<div id="C_4_5" class="casellaV"></div>
						<div id="C_4_6" class="casellaV"></div>
						<div id="C_4_7" class="casellaV"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<div id="C_5_1" class="casellaV"></div>
						<div id="C_5_2" class="casellaV"></div>
						<div id="C_5_3" class="casellaV"></div>
						<div id="C_5_4" class="casellaV"></div>
						<div id="C_5_5" class="casellaV"></div>
						<div id="C_5_6" class="casellaV"></div>
						<div id="C_5_7" class="casellaV"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<div id="C_6_1" class="casellaV"></div>
						<div id="C_6_2" class="casellaV"></div>
						<div id="C_6_3" class="casellaV"></div>
						<div id="C_6_4" class="casellaV"></div>
						<div id="C_6_5" class="casellaV"></div>
						<div id="C_6_6" class="casellaV"></div>
						<div id="C_6_7" class="casellaV"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<div id="C_R_1" class="bottoneR"></div>
						<div id="C_R_2" class="bottoneR"></div>
						<div id="C_R_3" class="bottoneR"></div>
						<div id="C_R_4" class="bottoneR"></div>
						<div id="C_R_5" class="bottoneR"></div>
						<div id="C_R_6" class="bottoneR"></div>
						<div id="C_R_7" class="bottoneR"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<div id="C_G_1" class="bottoneG"></div>
						<div id="C_G_2" class="bottoneG"></div>
						<div id="C_G_3" class="bottoneG"></div>
						<div id="C_G_4" class="bottoneG"></div>
						<div id="C_G_5" class="bottoneG"></div>
						<div id="C_G_6" class="bottoneG"></div>
						<div id="C_G_7" class="bottoneG"></div>
					</div>
					<div class="clearfix"></div>
					<div class="rigo">
						<input type="button" id="reset" value="RESET !!" style="margin: auto">
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
	</body>
	<script>
		var caselle=7;
		
		$(document).ready(function() {
			init();
			
			for(var i=1;i<=caselle;i++) {
				$("#C_G_"+i).click(
					function (evt) {
						var clicked = evt.target;
						var currentID = clicked.id || "C_G_0";
						aggiungiGiallo(currentID);
					}
				);

				$("#C_R_"+i).click(
					function (evt) {
						var clicked = evt.target;
						var currentID = clicked.id || "C_R_0";
						aggiungiRosso(currentID);
					}
				);
			}
			
			$("#reset").click(
				function () {
					init();
					
					for(var i=1;i<=caselle;i++) {
						for(var j=1;j<=6;j++) {
							var casellaCorrente="#C_"+j+"_"+i;
							
							if($(casellaCorrente).hasClass("casellaR")) {
								$(casellaCorrente).removeClass("casellaR");
								$(casellaCorrente).addClass("casellaV");
							}
							if($(casellaCorrente).hasClass("casellaG")) {
								$(casellaCorrente).removeClass("casellaG");
								$(casellaCorrente).addClass("casellaV");
							}
						}
					}
				}
			);
		});
		
		function init() {
			resettaCaselle();
			abilitaBottoni("R");
			abilitaBottoni("G");
			disabilitaReset();
		}
		
		function abilitaReset() {
			$("#reset").css("display", "block");
		}
		
		function disabilitaReset() {
			$("#reset").css("display", "none");
		}
		
		function resettaCaselle () {
			for(var i=1;i<=caselle;i++) {
				for(var j=1;j<=6;j++) {
					var casellaCorrente="#C_"+j+"_"+i;
					if($(casellaCorrente).hasClass("casellaR")) {
						$(casellaCorrente).removeClass("casellaR");
						$(casellaCorrente).addClass("casellaV");
					}
					if($(casellaCorrente).hasClass("casellaG")) {
						$(casellaCorrente).removeClass("casellaG");
						$(casellaCorrente).addClass("casellaV");
					}
				}
			}
		}
		
		function colora(colonna,colore) {
			var esisteCasella=0;
			for(var i=7;i>0;i--) {
				var casellaCorrente = $("#C_"+i+"_"+colonna);
				if(casellaCorrente.hasClass("casellaV")) {
					casellaCorrente.removeClass("casellaV");
					casellaCorrente.addClass("casella"+colore);
					return(i);
				}
			}
			return (0);
		}
		
		function disabilitaBottoni(colore) {
			for(var i=1;i<8;i++) {
				var bottoneCorrente=$("#C_"+colore+"_"+i);
				bottoneCorrente.css("display", "none");
			}
		}
		
		function abilitaBottoni(colore) {
			for(var i=1;i<8;i++) {
				var bottoneCorrente=$("#C_"+colore+"_"+i);
				bottoneCorrente.css("display", "flex");
			}
		}
		
		function aggiungiGiallo(i) {
			var colonna = i.substr(4);
			var rigo=colora(colonna,"G");
			if(rigo!=0) {
				disabilitaBottoni("G");
				abilitaBottoni("R");
			}
			controllaVittoria("G",colonna,rigo);
		}
		
		function aggiungiRosso(i) {
			var colonna = i.substr(4);
			var rigo=colora(colonna,"R");
			if(rigo!=0) {
				disabilitaBottoni("R");
				abilitaBottoni("G");
			}
			controllaVittoria("R",colonna,rigo);
		}
		
		function controllaVittoria(colore,colonna,rigo) {
			if(orizzontale(colore,rigo)||verticale(colore,colonna)||diagonale(colore)) {
				vinto();
			}
		}
		
		function getColore(rigo,colonna) {
			if(rigo<1||colonna<1||rigo>6||colonna>7) {
				return(false);
			}
			var casella=$("#C_"+rigo+"_"+colonna);
			if(casella.hasClass("casellaR")) {
				return ("R");
			} else if(casella.hasClass("casellaG")) {
				return ("G");
			} else {
				return (false);
			}
		}
		
		function verticale(colore,colonna) {
			for(var rigo=3; rigo<6; rigo++) {
				if(getColore((rigo-2),colonna)==colore&&
				   getColore((rigo-1),colonna)==colore&&
				   getColore(rigo,colonna)==colore&&
				   getColore((rigo+1),colonna)==colore) {
					return(true);
				}
			}
			return(false);
		}
		
		function orizzontale(colore,rigo) {
			for(var colonna=3; colonna<7; colonna++) {
				if(getColore(rigo,(colonna-2))==colore&&
				   getColore(rigo,(colonna-1))==colore&&
				   getColore(rigo,colonna)==colore&&
				   getColore(rigo,(colonna+1))==colore) {
					return(true);
				}
			}
			return(false);
		}
		
		function diagonale(colore) {
			for (var colonna=0;colonna<5;colonna++) {
				for (var rigo=0;rigo<7;rigo++) {
					if (getColore(rigo,colonna)==colore&&
						getColore(rigo+1,colonna+1)==colore&&
						getColore(rigo+2,colonna+2)==colore&&
						getColore(rigo+3,colonna+3)) {
							vinto();
					} else if (getColore(rigo,colonna)==colore&&
							   getColore(rigo-1,colonna+1)==colore&&
							   getColore(rigo-2,colonna+2)==colore&&
							   getColore(rigo-3,colonna+3)) {
						vinto();
					}
				}
			}
		}
		
		function vinto() {
			disabilitaBottoni("R");
			disabilitaBottoni("G");
			abilitaReset();
			
			setTimeout(function () {
				alert("hai vinto");
			}, 200);
		}
						  
	</script>
</html>